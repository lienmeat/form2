(function(c){c.fn.autoSuggest=function(l,C){function E(a){var c=0;for(k in a)a.hasOwnProperty(k)&&c++;return c}function J(){var b=a.extraParams;return c.isFunction(b)?b():b}var a=c.extend({asHtmlID:!1,startText:"Enter Name Here",usePlaceholder:!1,emptyText:"No Results Found",preFill:{},limitText:"No More Selections Are Allowed",selectedItemProp:"value",selectedValuesProp:"value",searchObjProps:"value",queryParam:"q",retrieveLimit:!1,extraParams:"",matchCase:!1,minChars:1,keyDelay:400,resultsHighlight:!0,
neverSubmit:!1,selectionLimit:!1,showResultList:!0,showResultListWhenNoMatch:!1,canGenerateNewSelections:!0,start:function(){},selectionClick:function(){},selectionAdded:function(){},selectionRemoved:function(a){a.remove()},formatList:!1,beforeRetrieve:function(a){return a},retrieveComplete:function(a){return a},resultClick:function(){},resultsComplete:function(){}},C),q,x=null;"function"==typeof l?q=l:"string"==typeof l?q=function(b,I){var q="";a.retrieveLimit&&(q="&limit="+encodeURIComponent(a.retrieveLimit));
x=c.getJSON(l+"?"+a.queryParam+"="+encodeURIComponent(b)+q+J(),function(c){c=a.retrieveComplete.call(this,c);I(c,b)})}:"object"==typeof l&&0<E(l)&&(q=function(a,c){c(l,a)});if(q)return this.each(function(b){function l(){var c=h.val().replace(/[\\]+|[\/]+/g,"");c!=y&&(y=c,c.length>=a.minChars?(f.addClass("loading"),F(c)):(f.removeClass("loading"),g.hide()))}function F(c){a.beforeRetrieve&&(c=a.beforeRetrieve.call(this,c));z();q(c,C)}function C(b,e){a.matchCase||(e=e.toLowerCase());e=e.replace("(",
"\\(","g").replace(")","\\)","g");var A=0;g.html(u.html("")).hide();for(var m=E(b),l=0;l<m;l++){var n=l;G++;var d=!1;if("value"==a.searchObjProps)var r=b[n].value;else for(var r="",q=a.searchObjProps.split(","),p=0;p<q.length;p++)var s=c.trim(q[p]),r=r+b[n][s]+" ";r&&(a.matchCase||(r=r.toLowerCase()),-1!=r.search(e)&&-1==j.val().search(","+b[n][a.selectedValuesProp]+",")&&(d=!0));if(d&&(d=c('<li class="as-result-item" id="as-result-item-'+n+'"></li>').click(function(){var b=c(this).data("data"),e=
b.num;if(0>=c("#as-selection-"+e,f).length&&!B){var K=b.attributes;h.val("").focus();y="";v(K,e);a.resultClick.call(this,b);g.hide()}B=!1}).mousedown(function(){t=!1}).mouseover(function(){c("li",u).removeClass("active");c(this).addClass("active")}).data("data",{attributes:b[n],num:G}),n=c.extend({},b[n]),r=a.matchCase?RegExp("(?![^&;]+;)(?!<[^<>]*)("+e+")(?![^<>]*>)(?![^&;]+;)","g"):RegExp("(?![^&;]+;)(?!<[^<>]*)("+e+")(?![^<>]*>)(?![^&;]+;)","gi"),a.resultsHighlight&&0<e.length&&(n[a.selectedItemProp]=
n[a.selectedItemProp].replace(r,"<em>$1</em>")),d=a.formatList?a.formatList.call(this,n,d):d.html(n[a.selectedItemProp]),u.append(d),delete n,A++,a.retrieveLimit&&a.retrieveLimit==A))break}f.removeClass("loading");0>=A&&u.html('<li class="as-message">'+a.emptyText+"</li>");u.css("width",f.outerWidth());(0<A||!a.showResultListWhenNoMatch)&&g.show();a.resultsComplete.call(this)}function v(b,e){j.val((j.val()||",")+b[a.selectedValuesProp]+",");var d=c('<li class="as-selection-item" id="as-selection-'+
e+'" data-value="'+b[a.selectedValuesProp]+'"></li>').click(function(){a.selectionClick.call(this,c(this));f.children().removeClass("selected");c(this).addClass("selected")}).mousedown(function(){t=!1}),g=c('<a class="as-close">&times;</a>').click(function(){j.val(j.val().replace(","+b[a.selectedValuesProp]+",",","));a.selectionRemoved.call(this,d);t=!0;h.focus();return!1});p.before(d.html(b[a.selectedItemProp]).prepend(g));a.selectionAdded.call(this,p.prev(),b[a.selectedValuesProp]);return p.prev()}
function H(a){if(0<c(":visible",g).length){var b=c("li",g),d="down"==a?b.eq(0):b.filter(":last"),f=c("li.active:first",g);0<f.length&&(d="down"==a?f.next():f.prev());b.removeClass("active");d.addClass("active")}}function z(){x&&(x.abort(),x=null)}if(a.asHtmlID)d=b=a.asHtmlID;else{b=b+""+Math.floor(100*Math.random());var d="as-input-"+b}a.start.call(this,{add:function(a){v(a,"u"+c("li",f).length).addClass("blur")},remove:function(a){j.val(j.val().replace(","+a+",",","));f.find('li[data-value = "'+
a+'"]').remove()}});var h=c(this);h.attr("autocomplete","off").addClass("as-input").attr("id",d);a.usePlaceholder?h.attr("placeholder",a.startText):h.val(a.startText);var t=!1;h.wrap('<ul class="as-selections" id="as-selections-'+b+'"></ul>').wrap('<li class="as-original" id="as-original-'+b+'"></li>');var f=c("#as-selections-"+b),p=c("#as-original-"+b),g=c('<div class="as-results" id="as-results-'+b+'"></div>').hide(),u=c('<ul class="as-list"></ul>'),j=c('<input type="hidden" class="as-values" name="as_values_'+
b+'" id="as-values-'+b+'" />'),m="";if("string"==typeof a.preFill){d=a.preFill.split(",");for(b=0;b<d.length;b++){var s={};s[a.selectedValuesProp]=d[b];""!=d[b]&&v(s,"000"+b)}m=a.preFill}else{m="";d=0;for(k in a.preFill)a.preFill.hasOwnProperty(k)&&d++;if(0<d)for(b=0;b<d;b++)s=a.preFill[b][a.selectedValuesProp],void 0==s&&(s=""),m=m+s+",",""!=s&&v(a.preFill[b],"000"+b)}""!=m&&(h.val(""),","!=m.substring(m.length-1)&&(m+=","),j.val(","+m),c("li.as-selection-item",f).addClass("blur").removeClass("selected"));
h.after(j);f.click(function(){t=!0;h.focus()}).mousedown(function(){t=!1}).after(g);var w=null,D=null,y="",B=!1;h.focus(function(){!a.usePlaceholder&&c(this).val()==a.startText&&""==j.val()?c(this).val(""):t&&(c("li.as-selection-item",f).removeClass("blur"),""!=c(this).val()&&(u.css("width",f.outerWidth()),g.show()));w&&clearInterval(w);w=setInterval(function(){a.showResultList&&(a.selectionLimit&&c("li.as-selection-item",f).length>=a.selectionLimit?(u.html('<li class="as-message">'+a.limitText+"</li>"),
g.show()):l())},a.keyDelay);t=!0;0==a.minChars&&F(c(this).val());return!0}).blur(function(){!a.usePlaceholder&&""==c(this).val()&&""==j.val()&&""==m&&0<a.minChars?c(this).val(a.startText):t&&(c("li.as-selection-item",f).addClass("blur").removeClass("selected"),g.hide());w&&clearInterval(w)}).keydown(function(b){first_focus=!1;switch(b.keyCode){case 38:b.preventDefault();H("up");break;case 40:b.preventDefault();H("down");break;case 8:if(""==h.val()){var e=j.val().split(","),e=e[e.length-2];f.children().not(p.prev()).removeClass("selected");
p.prev().hasClass("selected")?(j.val(j.val().replace(","+e+",",",")),a.selectionRemoved.call(this,p.prev())):(a.selectionClick.call(this,p.prev()),p.prev().addClass("selected"))}1==h.val().length&&(g.hide(),y="",z());0<c(":visible",g).length&&(D&&clearTimeout(D),D=setTimeout(function(){l()},a.keyDelay));break;case 9:case 188:if(a.canGenerateNewSelections){B=!0;var e=h.val().replace(/(,)/g,""),d=c("li.active:first",g);if(""!==e&&0>j.val().search(","+e+",")&&e.length>=a.minChars&&0===d.length){b.preventDefault();
b={};b[a.selectedItemProp]=e;b[a.selectedValuesProp]=e;e=c("li",f).length;v(b,"00"+(e+1));h.val("");z();break}}case 13:B=!1;d=c("li.active:first",g);0<d.length&&(d.click(),g.hide());(a.neverSubmit||0<d.length)&&b.preventDefault();break;case 27:case 16:case 20:z(),g.hide()}});var G=0})}})(jQuery);